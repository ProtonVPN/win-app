<?xml version="1.0" encoding="utf-8" ?>
<!--
Copyright (c) 2023 Proton AG

This file is part of ProtonVPN.

ProtonVPN is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

ProtonVPN is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with ProtonVPN.  If not, see <https://www.gnu.org/licenses/>.
-->

<countryControls:ItemsListControlBase x:Class="ProtonVPN.Client.UI.Countries.Controls.CityListControl"
                                      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                                      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                                      xmlns:countries="using:ProtonVPN.Client.UI.Countries"
                                      xmlns:countryControls="using:ProtonVPN.Client.UI.Countries.Controls"
                                      xmlns:custom="using:ProtonVPN.Client.Common.UI.Controls.Custom"
                                      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                                      xmlns:icons="using:ProtonVPN.Client.Common.UI.Assets.Icons"
                                      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                                      xmlns:pathIcons="using:ProtonVPN.Client.Common.UI.Assets.Icons.PathIcons"
                                      x:DefaultBindMode="OneWay"
                                      mc:Ignorable="d">
    <StackPanel>
        <countryControls:CountryFeatureTitleControl Title="{x:Bind Title}" />

        <ItemsRepeater ItemsSource="{x:Bind Cities}"
                       TabFocusNavigation="Local">
            <ItemsRepeater.ItemTemplate>
                <DataTemplate x:DataType="countries:CityViewModel">
                    <custom:DualCommandsRow Padding="12,0"
                                            IsContentEnabled="{x:Bind IsCityEnabled}"
                                            PrimaryCommandToolTip="{x:Bind PaidCityWarningLabel}"
                                            PrimaryCommandAutomationId="{x:Bind ConnectButtonAutomationId}"
                                            PrimaryCommandAutomationName="{x:Bind Name}"
                                            PrimaryCommand="{x:Bind ConnectCommand}"
                                            SecondaryCommandAutomationId="{x:Bind ShowServersButtonAutomationId}"
                                            SecondaryCommandText="{x:Bind Localizer.GetPluralFormat('Countries_Server', Servers.Count)}">

                        <custom:DualCommandsRow.PrimaryCommandContent>
                            <Grid>
                                <Image Height="20"
                                       HorizontalAlignment="Center"
                                       Source="{ThemeResource VpnPlusIllustrationSource}"
                                       Visibility="{x:Bind IsFreeUser, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                <Grid Visibility="{x:Bind IsFreeUser, Converter={StaticResource NotBooleanToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind Localizer.Get('Common_Actions_Connect')}"
                                               Visibility="{x:Bind IsActiveConnection, Converter={StaticResource NotBooleanToVisibilityConverter}}" />
                                    <TextBlock Text="{x:Bind Localizer.Get('Common_Actions_Disconnect')}"
                                               Visibility="{x:Bind IsActiveConnection, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                </Grid>
                            </Grid>
                        </custom:DualCommandsRow.PrimaryCommandContent>

                        <custom:DualCommandsRow.SecondaryCommandIcon>
                            <pathIcons:ThreeDotsVertical Foreground="{ThemeResource TextWeakColorBrush}" />
                        </custom:DualCommandsRow.SecondaryCommandIcon>

                        <StackPanel Orientation="Horizontal"
                                    Spacing="8">
                            <pathIcons:MapPin Foreground="{ThemeResource TextWeakColorBrush}" />
                            <TextBlock Text="{x:Bind Name}" />
                            <icons:ActiveDot Width="16"
                                             Height="16"
                                             AutomationProperties.AutomationId="{x:Bind ActiveConnectionAutomationId}"
                                             Visibility="{x:Bind IsActiveConnection, Converter={StaticResource BooleanToVisibilityConverter}}" />
                        </StackPanel>

                        <custom:DualCommandsRow.SecondaryCommandFlyout>
                            <Flyout Placement="BottomEdgeAlignedRight">
                                <StackPanel Width="286"
                                            Spacing="8">

                                    <countryControls:CountryFeatureTitleControl Title="{x:Bind Localizer.Get('Countries_Server')}"
                                                                                Margin="-8,0,4,0"
                                                                                InfoLabel="{x:Bind Localizer.Get('Countries_ServerLoad')}"
                                                                                ShowInfoOverlayCommand="{x:Bind ShowServerLoadOverlayCommand, Mode=OneTime}" />

                                    <ScrollViewer MaxHeight="180">
                                        <ItemsControl ItemsSource="{x:Bind Servers}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate x:DataType="countries:ServerViewModel">
                                                    <countryControls:ServerRowControl ServerViewModel="{x:Bind}" />
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </ScrollViewer>
                                </StackPanel>
                            </Flyout>
                        </custom:DualCommandsRow.SecondaryCommandFlyout>
                    </custom:DualCommandsRow>
                </DataTemplate>
            </ItemsRepeater.ItemTemplate>
        </ItemsRepeater>
    </StackPanel>
</countryControls:ItemsListControlBase>